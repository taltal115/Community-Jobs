"use strict";var ApplicationConfiguration=function(){var applicationModuleName="ui",applicationModuleVendorDependencies=["ngResource","ngAnimate","ui.router","ui.bootstrap","ui.utils","angularFileUpload","ui.select","ngSanitize","toastr","ngCsv","cgBusy","chart.js","ngTagsInput","uiSwitch","ui.ace","ngclipboard"],registerModule=function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule}}();
"use strict";angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function($locationProvider){$locationProvider.html5Mode(!0).hashPrefix("!")}]),angular.module(ApplicationConfiguration.applicationModuleName).run(["$rootScope","$state","Authentication",function($rootScope,$state,Authentication){$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){if(toState.data&&toState.data.roles&&toState.data.roles.length>0){var allowed=!1;toState.data.roles.forEach(function(role){if(void 0!==Authentication.user.roles&&Authentication.user.roles.indexOf(role)!==-1)return allowed=!0,!0}),allowed||(event.preventDefault(),$state.go("authentication.signin",{},{notify:!1}).then(function(){$rootScope.$broadcast("$stateChangeSuccess","authentication.signin",{},toState,toParams)}))}}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){$state.previous={state:fromState,params:fromParams,href:$state.href(fromState,fromParams)}})}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])});
"use strict";ApplicationConfiguration.registerModule("activities");
"use strict";ApplicationConfiguration.registerModule("alerts");
"use strict";ApplicationConfiguration.registerModule("booster");
"use strict";ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("core.admin",["core"]),ApplicationConfiguration.registerModule("core.admin.routes",["ui.router"]);
"use strict";ApplicationConfiguration.registerModule("users",["core"]),ApplicationConfiguration.registerModule("users.admin",["core.admin"]),ApplicationConfiguration.registerModule("users.admin.routes",["core.admin.routes"]);
"use strict";angular.module("activities").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Activity log",state:"activities",stateHome:"activities.activities",position:6,roles:["user","admin"],seats:["*"]})}]);
"use strict";angular.module("activities").config(["$stateProvider",function($stateProvider){$stateProvider.state("activities",{"abstract":!0,url:"",template:"<ui-view/>",data:{roles:["user","admin"]}}).state("activities.activities",{url:"/activities",templateUrl:"modules/activity/client/views/activities.client.view.html",data:{roles:["user","admin"]}})}]);
"use strict";angular.module("activities").controller("ActivitiesController",["$scope","$stateParams","$location","$state","$filter","Authentication","Activities",function($scope,$stateParams,$location,$state,$filter,Authentication,Activities){$scope.authentication=Authentication,$scope.sorter=["-timestamp"],$scope.selectedItemsPerPage=20,$scope.sorterStates={timestamp:2,user:0,description:0},$scope.buildPager=function(){$scope.pagedItems=[],$scope.itemsPerPage=$scope.selectedItemsPerPage,$scope.currentPage=1,$scope.figureOutItemsToDisplay()},$scope.figureOutItemsToDisplay=function(){$scope.filteredItems=$filter("filter")($scope.activities,{$:$scope.search}),$scope.orderedItems=$filter("orderBy")($scope.filteredItems,$scope.sorter),$scope.filterLength=$scope.filteredItems.length;var begin=($scope.currentPage-1)*$scope.itemsPerPage,end=begin+$scope.itemsPerPage;$scope.pagedItems=$scope.orderedItems.slice(begin,end)},$scope.pageChanged=function(){$scope.figureOutItemsToDisplay()},$scope.setSorter=function(colName,field){0===$scope.sorterStates[colName]?($scope.sorter.push(field),$scope.sorterStates[colName]=1):1===$scope.sorterStates[colName]?($scope.sorter[$scope.sorter.indexOf(field)]="-"+field,$scope.sorterStates[colName]=2):($scope.sorter.splice($scope.sorter.indexOf("-"+field),1),$scope.sorterStates[colName]=0),$scope.figureOutItemsToDisplay()},$scope.find=function(){$scope.loadActivities=Activities.query(function(data){$scope.activities=data,$scope.buildPager()})}}]);
"use strict";angular.module("activities").factory("Activities",["$resource",function($resource){return $resource("api/activities/:activityId",{activityId:"@_id"},{update:{method:"PUT"}})}]);
"use strict";angular.module("alerts").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{type:"dropdown",title:"Alerts",state:"alerts",stateHome:"alerts",position:4,roles:["user","admin"],seats:["*"]}),Menus.addSubMenuItem("topbar","alerts",{title:"Events",state:"alerts.events",roles:["user","admin"],seats:["*"]}),Menus.addSubMenuItem("topbar","alerts",{title:"Definitions",state:"alerts.definitions",roles:["user","admin"],seats:["*"]}),Menus.addSubMenuItem("topbar","alerts",{title:"Services",state:"alerts.services",roles:["user","admin"],seats:["*"]})}]);
"use strict";angular.module("alerts").config(["$stateProvider",function($stateProvider){$stateProvider.state("alerts",{"abstract":!0,url:"/jobs",template:"<ui-view/>",data:{roles:["user","admin"]}}).state("alerts.events",{url:"/events",templateUrl:"modules/jobs/client/views/events.client.view.html",data:{roles:["user","admin"]}}).state("alerts.definitions",{url:"/definitions",templateUrl:"modules/jobs/client/views/jobs.client.view.html",data:{roles:["user","admin"]}}).state("alerts.services",{url:"/services",templateUrl:"modules/jobs/client/views/list.client.view.html",data:{roles:["user","admin"]}})}]);
"use strict";angular.module("alerts").controller("AlertsController",["$scope","$stateParams","$location","$state","$filter","Authentication","AlertsFactory","toastr",function($scope,$stateParams,$location,$state,$filter,Authentication,AlertsFactory,toastr){$scope.authentication=Authentication,$scope.sorter=["-name"],$scope.selectedItemsPerPage=20,$scope.sorterStates={name:2,field_type:0,alert_id:0,time:0},$scope.search="",$scope.category=["programmatic-supply","programmatic-demand","direct"],$scope["programmatic-supply"]=[],$scope["programmatic-demand"]=[],$scope.direct=[],$scope.categoryModel="programmatic-supply",$scope.getAlertsTable=function(category,callback){$scope.alerts=[],$scope[category]=[],AlertsFactory.requestAlerts(function(err,data){err?(toastr.error("The service is probably offline","Alert service error"),callback(err)):(data.forEach(function(event){category===event.category&&$scope[category].push(event)}),$scope.buildPager(),callback(null,$scope[category]))})},$scope.changeCategory=function(){$scope.getAlertsTable($scope.categoryModel,function(err,val){err||($scope.alerts=[],$scope.alerts=val)})},$scope.getEvents=function(){$scope.getAlertsTable("programmatic-supply",function(err,val){err||($scope.alerts=val)})},$scope.buildPager=function(){$scope.pagedItems=[],$scope.itemsPerPage=$scope.selectedItemsPerPage,$scope.currentPage=1,$scope.figureOutItemsToDisplay()},$scope.figureOutItemsToDisplay=function(){$scope.filteredItems=$filter("filter")($scope[$scope.categoryModel],{$:$scope.search}),$scope.orderedItems=$filter("orderBy")($scope.filteredItems,$scope.sorter),$scope.filterLength=$scope.filteredItems.length;var begin=($scope.currentPage-1)*$scope.itemsPerPage,end=begin+$scope.itemsPerPage;$scope.pagedItems=$scope.orderedItems.slice(begin,end)},$scope.pageChanged=function(){$scope.figureOutItemsToDisplay()},$scope.setSorter=function(colName,field){0===$scope.sorterStates[colName]?($scope.sorter.push(field),$scope.sorterStates[colName]=1):1===$scope.sorterStates[colName]?($scope.sorter[$scope.sorter.indexOf(field)]="-"+field,$scope.sorterStates[colName]=2):($scope.sorter.splice($scope.sorter.indexOf("-"+field),1),$scope.sorterStates[colName]=0),$scope.figureOutItemsToDisplay()}}]);
"use strict";angular.module("alerts").controller("EventsController",["$scope","$stateParams","$location","$state","$filter","Authentication","AlertsFactory","toastr",function($scope,$stateParams,$location,$state,$filter,Authentication,AlertsFactory,toastr){$scope.authentication=Authentication,$scope.sorter=["-time"],$scope.selectedItemsPerPage=20,$scope.sorterStates={name:0,field_type:0,alert_id:0,time:1},$scope.search="",$scope.category=["programmatic-supply","programmatic-demand","direct"],$scope["programmatic-supply"]=[],$scope["programmatic-demand"]=[],$scope.direct=[],$scope.categoryModel="programmatic-supply",$scope.getTable=function(category,callback){$scope.events=[],$scope[category]=[],AlertsFactory.requestEvents(category,function(err,data){err?(toastr.error("The service is probably offline","Alert service error"),callback(err)):(data.result.forEach(function(event){category===event.category&&$scope[category].push(event)}),$scope.buildPager(),callback(null,$scope[category]))})},$scope.reactivate=function(event){AlertsFactory.reactivate(event,function(err,res){err?toastr.error(err,"Unflag error"):(toastr.success("The "+event.field_type+" "+event.name+" has been reactivated.","Reactivate complete"),$scope.getTable($scope.categoryModel,function(err,val){err||($scope.events=[],$scope.events=val)}))})},$scope.reactivateAll=function(){var idsArray=[];$scope[$scope.categoryModel].forEach(function(item){idsArray.push(item._id)});var ResObj={};ResObj[$scope.categoryModel]=idsArray,AlertsFactory.reactivate(ResObj,function(err,res){err?toastr.error(err,"Unflag error"):(toastr.success("All "+$scope[$scope.categoryModel].length+" "+$scope.categoryModel+" events has been reactivated.","Reactivate All complete"),$scope.getTable($scope.categoryModel,function(err,val){err||($scope.events=[],$scope.events=val)}))})},$scope.changeCategory=function(){$scope.getTable($scope.categoryModel,function(err,val){err||($scope.events=[],$scope.events=val)})},$scope.getEvents=function(){$scope.getTable("programmatic-supply",function(err,val){err||($scope.events=val)})},$scope.buildPager=function(){$scope.pagedItems=[],$scope.itemsPerPage=$scope.selectedItemsPerPage,$scope.currentPage=1,$scope.figureOutItemsToDisplay()},$scope.figureOutItemsToDisplay=function(){$scope.filteredItems=$filter("filter")($scope[$scope.categoryModel],{$:$scope.search}),$scope.orderedItems=$filter("orderBy")($scope.filteredItems,$scope.sorter),$scope.filterLength=$scope.filteredItems.length;var begin=($scope.currentPage-1)*$scope.itemsPerPage,end=begin+$scope.itemsPerPage;$scope.pagedItems=$scope.orderedItems.slice(begin,end)},$scope.pageChanged=function(){$scope.figureOutItemsToDisplay()},$scope.setSorter=function(colName,field){0===$scope.sorterStates[colName]?($scope.sorter.push(field),$scope.sorterStates[colName]=1):1===$scope.sorterStates[colName]?($scope.sorter[$scope.sorter.indexOf(field)]="-"+field,$scope.sorterStates[colName]=2):($scope.sorter.splice($scope.sorter.indexOf("-"+field),1),$scope.sorterStates[colName]=0),$scope.figureOutItemsToDisplay()}}]);
"use strict";angular.module("alerts").controller("ServicesController",["$scope","$stateParams","$location","$state","$filter","Authentication","ServicesFactory","toastr",function($scope,$stateParams,$location,$state,$filter,Authentication,ServicesFactory,toastr){$scope.authentication=Authentication,$scope.sorter=["-displayName"],$scope.selectedItemsPerPage=20,$scope.sorterStates={displayName:2,profession:0,email:0,age:0},$scope.search="",$scope.getList=function(){ServicesFactory.requestServices(function(err,res){err?console.error(err):(console.log(res),$scope.users=res,$scope.buildPager())})},$scope.buildPager=function(){$scope.pagedItems=[],$scope.itemsPerPage=$scope.selectedItemsPerPage,$scope.currentPage=1,$scope.figureOutItemsToDisplay()},$scope.figureOutItemsToDisplay=function(){$scope.filteredItems=$filter("filter")($scope.users,{$:$scope.search}),$scope.orderedItems=$filter("orderBy")($scope.filteredItems,$scope.sorter),$scope.filterLength=$scope.filteredItems.length;var begin=($scope.currentPage-1)*$scope.itemsPerPage,end=begin+$scope.itemsPerPage;$scope.pagedItems=$scope.orderedItems.slice(begin,end)},$scope.pageChanged=function(){$scope.figureOutItemsToDisplay()},$scope.setSorter=function(colName,field){0===$scope.sorterStates[colName]?($scope.sorter.push(field),$scope.sorterStates[colName]=1):1===$scope.sorterStates[colName]?($scope.sorter[$scope.sorter.indexOf(field)]="-"+field,$scope.sorterStates[colName]=2):($scope.sorter.splice($scope.sorter.indexOf("-"+field),1),$scope.sorterStates[colName]=0),$scope.figureOutItemsToDisplay()}}]);
"use strict";angular.module("alerts").factory("AlertsFactory",["$http",function($http){var factory={};return factory.requestAlerts=function(callback){var dataUrl="/api/jobs";$http.get(dataUrl).success(function(result){callback(null,result)}).error(function(err){callback(err)})},factory.requestEvents=function(category,callback){var dataUrl="/api/events?flag=false&category="+category;$http.get(dataUrl).success(function(result){callback(null,result)}).error(function(err){callback(err)})},factory.reactivate=function(data,callback){var dataUrl="/api/events?flag=false";$http.post(dataUrl,data).success(function(result){callback(null,result)})},factory}]);
"use strict";angular.module("alerts").factory("ServicesFactory",["$http",function($http){var factory={};return factory.requestServices=function(callback){var dataUrl="/api/services/list";$http.get(dataUrl).success(function(result){callback(null,result)}).error(function(err){callback(err)})},factory}]);
"use strict";angular.module("booster").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{type:"dropdown",title:"Tools",state:"tools",stateHome:"tools",position:5,roles:["user","admin"],seats:["Positive Mobile","Positive Mobile LATAM"]}),Menus.addSubMenuItem("topbar","tools",{title:"URL Decoder",state:"tools.url_decoder",roles:["user","admin"],seats:["Positive Mobile"]}),Menus.addSubMenuItem("topbar","tools",{title:"Supply Daily Report",state:"tools.supply_daily_reports",roles:["user","admin"],seats:["Positive Mobile"]}),Menus.addSubMenuItem("topbar","tools",{title:"Demand Daily Report",state:"tools.demand_daily_reports",roles:["user","admin"],seats:["Positive Mobile","Positive Mobile LATAM"]})}]);
"use strict";angular.module("booster").config(["$stateProvider",function($stateProvider){$stateProvider.state("tools",{"abstract":!0,url:"/tools",template:"<ui-view/>",data:{roles:["user","admin"]}}).state("tools.supply_daily_reports",{url:"/supply/daily_report",templateUrl:"modules/booster/client/views/supply_daily_reports.client.view.html",data:{roles:["user","admin"]}}).state("tools.url_decoder",{url:"/decoder",templateUrl:"modules/booster/client/views/decoder.client.view.html",data:{roles:["user","admin"]}}).state("tools.demand_daily_reports",{url:"/demand/daily_report",templateUrl:"modules/booster/client/views/demand_daily_reports.client.view.html",data:{roles:["user","admin"]}})}]);
"use strict";angular.module("booster").controller("urlDecoderCtrl",["$scope","toastr","DecoderFactory",function($scope,toastr,DecoderFactory){function parseDecString(field_name){switch(field_name){case"e":return"Event type";case"supply_name":return"Supply Source Name";case"app":return"Publisher Name";case"tag_id":return"Tag ID";case"adv_name":return"Advertiser Name";case"vast_name":return"Deal Name";case"app_name":return"App Name";case"app_store_url":return"App Store URL";case"app_bundle_id":return"App Bundle ID";case"ecpm":return"Player Version";case"errc":return"Error Code";case"errm":return"Error Message"}}$scope.main_input="Type (or pass) the decoded message here...",$scope.decode_result="Results will appear here....",$scope.decodeButtonDisable=!0,$scope.decipherButtonDisable=!1,$scope.urlDecipher=function(){$scope.resObj={},$scope.textarea?($scope.clearShow=!0,DecoderFactory.decodedRequest($scope.textarea,function(err,resVal){return resVal&&resVal.ok?($scope.decodeButtonDisable=!1,$scope.decipherButtonDisable=!0,DecoderFactory.decipherRequest(resVal.ok.result,function(err,res){res&&res.ok?(document.getElementById("decode").disabled=!1,$scope.decode_result=res.ok.result,res.ok.result.split("&").forEach(function(val){val.split("=")[0]&&void 0!==parseDecString(val.split("=")[0])&&val.split("=")[1]&&($scope.resObj[parseDecString(val.split("=")[0])]=val.split("=")[1])}),toastr.success(res.ok.message,"Done Deciphering")):(toastr.error("Invalid input. Try again.","Error deciphering"),$scope.decode_result="Results will appear here....")})):void toastr.error("Invalid input. Try again.","Error decoding")})):toastr.error("Empty input. Try again.","Error deciphering")},$scope.urlDecode=function(){if("Results will appear here...."!==$scope.decode_result)return DecoderFactory.decodedRequest($scope.decode_result,function(err,res){res&&res.ok?($scope.decode_result=res.ok.result,toastr.success(res.ok.message,"Done Decoding")):toastr.error("Invalid input. Try again.","Error decoding")})},$scope.clearAll=function(){$scope.clearShow=!1,$scope.decodeButtonDisable=!0,$scope.decipherButtonDisable=!1,$scope.decode_result="Results will appear here....",$scope.textarea="",$scope.main_input="Type (or pass) the decoded message here..."}}]);
"use strict";angular.module("booster").controller("DemandDRController",["$scope","Authentication","toastr","$http","SourcePartnerDailyReportFactory","$q",function($scope,Authentication,toastr,$http,SourcePartnerDailyReportFactory,$q){$scope.authentication=Authentication,$scope.opened={},$scope.form={},$scope.sp={},$scope.csvHeaders=["Platform","Demand Partner","Impressions","Revenue","Opportunities"],$scope.csvCodeHeaders=["platform","demand_partner","impressions","revenue","opportunities"],$scope.loginsContainer=[],$scope.lastPartnerDataContainer=[],$scope.SubTotal={impressions:0,cost:0,cpm:0},$scope.timeFrame="Yesterday",$scope.timeFrames=["Today","Yesterday","Last 7 days","Month to date","Custom"],$scope.Totals={},$scope.sp_select=[],$scope.isRequesting=!1,$scope.gotReport=!1,$scope.Totals={totalAdOps:0,totalImps:0,totalRevenue:0},$scope.sp_select=[],$scope.AdOps=0,$scope.Imps=0,$scope.Revenue=0,$scope.addAll=function(){$scope.sp.item=$scope.loginsContainer},$scope.removeAll=function(){$scope.sp.item=[]},$scope.resetRange=function(){$scope.from=$scope.to=null},$scope.resetRange(),$scope.open=function($event,element){$event.preventDefault(),$event.stopPropagation(),$scope.opened[element]=!0},$scope.checkDates=function(){var from=new Date($scope.from),to=new Date($scope.to);$scope.from&&$scope.to&&to<from&&($scope.to=null,toastr.error("From date is grater then To date.","Validation error"))},$scope.getDateString=function(utcDateObj){return utcDateObj?new Date(utcDateObj-6e4*utcDateObj.getTimezoneOffset()).toISOString():null},$scope.arrayObjectIndexOf=function(myArray,searchTerm,property){for(var i=0,len=myArray.length;i<len;i++)if(myArray[i][property]===searchTerm)return i;return-1},$scope.initDemand=function(){SourcePartnerDailyReportFactory.getLogins("demand",function(err,val){if(err){var errMsg=err.error.code||"Internal service error!";toastr.error(errMsg,"Error")}else $scope.loginList=val,Object.keys($scope.loginList).forEach(function(platform){$scope.loginsContainer.push($scope.loginList[platform])}),$scope.loginsContainer=[].concat.apply([],$scope.loginsContainer)})},$scope.loadData=function(item,timeFrame,selectedContainer,length){$scope.AdOps=0,$scope.Imps=0,$scope.Revenue=0,$scope.defer=$q.defer(),$scope.deferSummery=$q.defer(),$scope["myDefer_"+item]=$scope.defer.promise,$scope.summery=$scope.deferSummery.promise,$scope.lastPartnerDataContainer=[];var platform=item.toLowerCase().trim(),obj={platform:platform,data:$scope.loginList,timeFrame:timeFrame,user:$scope.authentication,form:$scope.timeFrame};$scope.PartnersData=null,$scope.lastPartnerDataContainer=selectedContainer,SourcePartnerDailyReportFactory.postPartnerReport(obj,"demand",function(err,val){if(err){$scope.isRequesting=!1;var errMsg="Internal service error for "+item+"!";toastr.error(errMsg,"Error"),$scope["myDefer_"+item]=$scope.defer.resolve()}else $scope.count++,$scope.PartnersData=val,$scope.lastPartnerDataContainer.forEach(function(selected){$scope.PartnersData[platform].forEach(function(val){val.demand_partner===selected.demand_partner&&(selected.impressions=val.impressions,selected.opportunities=val.opportunities,selected.revenue=val.revenue,selected.status=val.status)})}),$scope["myDefer_"+item]=$scope.defer.resolve(),"Custom"===$scope.timeFrame?$scope.timeTitle="Data valid for "+$scope.from.toLocaleDateString()+" - "+$scope.to.toLocaleDateString():$scope.timeTitle="Data valid for "+$scope.timeFrame,length===$scope.count&&($scope.isRequesting=!1,$scope.lastPartnerDataContainer=[].concat.apply([],$scope.lastPartnerDataContainer),$scope.lastPartnerDataContainer.forEach(function(item){$scope.Imps+=item.impressions?item.impressions:0,$scope.AdOps+=item.opportunities?item.opportunities:0,$scope.Revenue+=parseFloat(item.revenue)?parseFloat(item.revenue):0}),$scope.Totals={totalAdOps:$scope.AdOps,totalImps:$scope.Imps,totalRevenue:$scope.Revenue},$scope.csvExport=[].concat.apply([],$scope.lastPartnerDataContainer),SourcePartnerDailyReportFactory.summery($scope.lastPartnerDataContainer,$scope.Totals,obj,"demand",function(err,val){$scope.summery=$scope.deferSummery.resolve(),err?toastr.error("Operation failed","Error"):toastr.success("Operation Complete","Success")}))})},$scope.runReport=function(){$scope.count=0;var selectedContainer=[];if(void 0===$scope.sp.item||0===$scope.sp.item.length)return toastr.error("You must select at least one Source Partner.","Validation Error"),!1;if(!("Custom"!==$scope.timeFrame||$scope.from&&$scope.to))return toastr.error("You must select from and to dates.","Validation Error"),!1;$scope.gotReport=!0,$scope.isRequesting=!0;var timeframe={};timeframe="Custom"===$scope.timeFrame?{timeString:$scope.timeFrame,from:$scope.getDateString($scope.from),to:$scope.getDateString($scope.to)}:$scope.timeFrame,$scope.sp.item.forEach(function(selectedItem){$scope.loginsContainer.forEach(function(loginItem){loginItem.demand_partner===selectedItem.demand_partner&&selectedContainer.push({demand_partner:selectedItem.demand_partner,platform:selectedItem.platform,impressions:0,opportunities:0,revenue:0})})}),Object.keys($scope.loginList).forEach(function(platform){$scope.loginList[platform].forEach(function(dp){dp.active=$scope.arrayObjectIndexOf(selectedContainer,dp.demand_partner,"demand_partner")>=0})});var obj={};selectedContainer.forEach(function(i){obj[i.platform]?obj[i.platform].push(i.demand_partner):obj[i.platform]=[i.platform]}),Object.keys(obj).forEach(function(sp){$scope.loadData(sp,timeframe,selectedContainer,Object.keys(obj).length)})}}]);
"use strict";angular.module("booster").controller("SupplyDRController",["$scope","Authentication","toastr","$http","SourcePartnerDailyReportFactory","$q",function($scope,Authentication,toastr,$http,SourcePartnerDailyReportFactory,$q){$scope.authentication=Authentication,$scope.opened={},$scope.form={},$scope.sp={},$scope.csvHeaders=["platform","supply_partner","cost","impressions","cpm"],$scope.loginsContainer=[],$scope.lastPartnerDataContainer=[],$scope.timeFrame="Yesterday",$scope.timeFrames=["Today","Yesterday","Last 7 days","Month to date","Custom"],$scope.gotReport=!1,$scope.Totals={totalCost:0,totalImps:0,totalCpm:0},$scope.sp_select=[],$scope.isRequesting=!1,$scope.Imps=0,$scope.Cost=0,$scope.Cpm=0,$scope.addAll=function(){$scope.sp.item=$scope.loginsContainer},$scope.removeAll=function(){$scope.sp.item=[]},$scope.resetRange=function(){$scope.from=$scope.to=null},$scope.resetRange(),$scope.open=function($event,element){$event.preventDefault(),$event.stopPropagation(),$scope.opened[element]=!0},$scope.checkDates=function(){var from=new Date($scope.from),to=new Date($scope.to);$scope.from&&$scope.to&&to<from&&($scope.to=null,toastr.error("From date is grater then To date.","Validation error"))},$scope.getDateString=function(utcDateObj){return utcDateObj?new Date(utcDateObj-6e4*utcDateObj.getTimezoneOffset()).toISOString():null},$scope.arrayObjectIndexOf=function(myArray,searchTerm,property){for(var i=0,len=myArray.length;i<len;i++)if(myArray[i][property]===searchTerm)return i;return-1},$scope.initSupply=function(){$scope.count=0,SourcePartnerDailyReportFactory.getLogins("supply",function(err,val){if(err){var errMsg=err.error.code||"Internal service error!";toastr.error(errMsg,"Error")}else $scope.loginList=val,Object.keys($scope.loginList).forEach(function(platform){$scope.loginsContainer.push($scope.loginList[platform])}),$scope.loginsContainer=[].concat.apply([],$scope.loginsContainer)})},$scope.loadData=function(item,timeFrame,selectedContainer,length){$scope.Imps=0,$scope.Cost=0,$scope.Cpm=0,$scope.defer=$q.defer(),$scope.deferSummery=$q.defer(),$scope["myDefer_"+item]=$scope.defer.promise,$scope.summery=$scope.deferSummery.promise,$scope.lastPartnerDataContainer=[];var platform=item.toLowerCase().trim(),obj={platform:platform,data:$scope.loginList,timeFrame:timeFrame,user:$scope.authentication,form:$scope.timeFrame};$scope.lastPartnerDataContainer=selectedContainer,SourcePartnerDailyReportFactory.postPartnerReport(obj,"supply",function(err,val){if(err){$scope.isRequesting=!1;var errMsg="Internal service error for "+item+"!";toastr.error(errMsg,"Error"),$scope["myDefer_"+item]=$scope.defer.resolve()}else $scope.count++,$scope.PartnersData=val,$scope.lastPartnerDataContainer.forEach(function(selected){$scope.PartnersData[platform].forEach(function(val){val.supply_partner===selected.supply_partner&&(selected.impressions=val.impressions,selected.cost=val.cost,selected.cpm=val.cpm,selected.status=val.status)})}),$scope["myDefer_"+item]=$scope.defer.resolve(),length===$scope.count&&("Custom"===$scope.timeFrame?$scope.timeTitle="Data valid for "+$scope.from.toLocaleDateString()+" - "+$scope.to.toLocaleDateString():$scope.timeTitle="Data valid for "+$scope.timeFrame,$scope.lastPartnerDataContainer=[].concat.apply([],$scope.lastPartnerDataContainer),$scope.lastPartnerDataContainer.forEach(function(item){$scope.Imps+=item.impressions?item.impressions:0,$scope.Cost+=parseFloat(item.cost)?parseFloat(item.cost):0,$scope.Cpm+=parseFloat(item.cpm)?parseFloat(item.cpm):0}),$scope.Totals={totalCost:$scope.Cost,totalImps:$scope.Imps,totalCpm:0!==$scope.Imps?$scope.Cost/$scope.Imps*1e3:0},$scope.isRequesting=!1,$scope.csvExport=[].concat.apply([],$scope.lastPartnerDataContainer),SourcePartnerDailyReportFactory.summery($scope.lastPartnerDataContainer,$scope.Totals,obj,"supply",function(err,val){$scope.summery=$scope.deferSummery.resolve(),err?toastr.error("Operation failed","Error"):toastr.success("Operation Complete","Success")}))})},$scope.runReport=function(){$scope.count=0;var selectedContainer=[];if(void 0===$scope.sp.item||0===$scope.sp.item.length)return toastr.error("You must select at least one Source Partner.","Validation Error"),!1;if(!("Custom"!==$scope.timeFrame||$scope.from&&$scope.to))return toastr.error("You must select from and to dates.","Validation Error"),!1;$scope.gotReport=!0,$scope.isRequesting=!0;var timeframe={};timeframe="Custom"===$scope.timeFrame?{timeString:$scope.timeFrame,from:$scope.getDateString($scope.from),to:$scope.getDateString($scope.to)}:$scope.timeFrame,$scope.sp.item.forEach(function(selectedItem){$scope.loginsContainer.forEach(function(loginItem){loginItem.supply_partner===selectedItem.supply_partner&&selectedContainer.push({supply_partner:selectedItem.supply_partner,platform:selectedItem.platform,cost:0,impressions:0,cpm:0})})}),Object.keys($scope.loginList).forEach(function(platform){$scope.loginList[platform].forEach(function(dp){dp.active=$scope.arrayObjectIndexOf(selectedContainer,dp.supply_partner,"supply_partner")>=0})});var obj={};selectedContainer.forEach(function(i){obj[i.platform]?obj[i.platform].push(i.supply_partner):obj[i.platform]=[i.platform]}),Object.keys(obj).forEach(function(item){$scope.loadData(item,timeframe,selectedContainer,Object.keys(obj).length)})}}]);
"use strict";angular.module("booster").factory("DecoderFactory",["$http",function($http){var factory={},decipherUrl="/api/decipher";factory.decipherRequest=function(data,callback){$http.post(decipherUrl,{encoded_data:data}).success(function(result){callback(null,result)}).error(function(err){callback(err)})};var decodedUrl="/api/decoder";return factory.decodedRequest=function(data,callback){$http.post(decodedUrl,{data:data}).success(function(result){callback(null,result)}).error(function(err){callback(err)})},factory}]);
"use strict";angular.module("booster").factory("SourcePartnerDailyReportFactory",["$http",function($http){var factory={};return factory.getLogins=function(department,callback){var url="/api/source-partner/logins";$http({url:url,method:"GET",timeout:12e4,params:{department:department}}).success(function(response){callback(null,response)}).error(function(errResponse){console.error(department+" Error with request (getLogins) [client <-> server] to: "+url),callback(errResponse)})},factory.getPartners=function(department,callback){var url="/api/source-partner/lastDBData";$http({url:url,method:"GET",timeout:12e4,params:{department:department}}).success(function(response){callback(null,response)}).error(function(errResponse){console.error(department+" Error with request (getPartners) [client <-> server] to: "+url),callback(errResponse)})},factory.postPartnerReport=function(obj,department,callback){var runUrl="/api/source-partner/process/",payload={url:runUrl+obj.platform,method:"POST",timeout:12e4,params:{department:department},data:{payload:obj.data,timeFrame:obj.timeFrame,user:obj.user}};$http(payload).success(function(response){callback(null,response)}).error(function(errResponse){console.error("Error with request (postPartnerReport) [client <-> server] to: "+runUrl+obj.platform),callback(errResponse)})},factory.summery=function(lastPartnerDataContainer,Totals,obj,department,callback){var runUrl="/api/source-partner/summery",payload={url:runUrl,method:"POST",timeout:12e4,params:{department:department},data:{lastPartnerDataContainer:lastPartnerDataContainer,Totals:Totals,timeFrame:obj.timeFrame,user:obj.user}};$http(payload).success(function(response){callback(null,response)}).error(function(errResponse){console.error("Error with request (summery) [client <-> server] to: "+runUrl),callback(errResponse)})},factory}]);
"use strict";angular.module("core").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("not-found"),$stateProvider.state("home",{url:"/",templateUrl:"modules/core/client/views/home.client.view.html"}).state("not-found",{url:"/not-found",templateUrl:"modules/core/client/views/404.client.view.html"})}]);
"use strict";angular.module("core").controller("HeaderController",["$scope","$state","Authentication","Menus",function($scope,$state,Authentication,Menus){$scope.$state=$state,$scope.authentication=Authentication,$scope.menu=Menus.getMenu("topbar"),$scope.isCollapsed=!1,$scope.toggleCollapsibleMenu=function(){$scope.isCollapsed=!$scope.isCollapsed},$scope.$on("$stateChangeSuccess",function(){$scope.isCollapsed=!1})}]);
"use strict";angular.module("core").controller("HomeController",["$scope","$http","$location","$filter","Authentication",function($scope,$http,$location,$filter,Authentication){$scope.authentication=Authentication,$scope.opened={},$scope.timeZone="America/New_York",$scope.timeFrame="Today",$scope.fromModel=null,$scope.toModel=null,$scope.typeModel={},$scope.environmentModel={},$scope.filters=[],$scope.getDateString=function(utcDateObj){return utcDateObj?new Date(utcDateObj-6e4*utcDateObj.getTimezoneOffset()).toISOString():null},$scope.$watch("authentication.user",function(){$scope.authentication.user&&($scope.isPartnerUser=function(){return!($scope.authentication.user.roles.indexOf("user")>=0||$scope.authentication.user.roles.indexOf("admin")>=0)},$http.get("api/reports/metadata",{params:{type:"Supply"}}).then(function(response){$scope.metadata=response.data,$scope.loadCharts()}))}),$scope.resetRange=function(){$scope.fromModel=null,$scope.toModel=null,"Custom"!==$scope.timeFrame&&$scope.loadCharts()},$scope.open=function($event,element){$event.preventDefault(),$event.stopPropagation(),$scope.opened[element]=!0},$scope.getAllMetricsReport=function(){$scope.allMetricsError=null,$scope.allMetrics=$scope.metadata.metrics.filter(function(metric){return metric.dashboard});var allMetricsReport={type:"Supply",dimensions:[],metrics:$scope.allMetrics.map(function(metric){return metric.fieldName}),timeZone:$scope.timeZone,timeLevel:"Overall",timeFrame:$scope.timeFrame,from:$scope.from,to:$scope.to,filters:$scope.filters};$scope.loadAllMetrics=$http.post("api/reports/run",allMetricsReport).then(function(response){$scope.allMetricsResults=[],response.data.length&&($scope.allMetricsResults=response.data[0])},function(errResponse){$scope.allMetricsResults=null,$scope.allMetricsError=errResponse.data.message})},$scope.getIvcOverTimeReport=function(){$scope.timeLineMetrics=$scope.metadata.metrics.filter(function(metric){return metric.dashboardTimeLine}),$scope.timeLineMetricsFields=$scope.timeLineMetrics.map(function(metric){return metric.fieldName}),$scope.timeLineMetricsDisplayNames=$scope.timeLineMetrics.map(function(metric){return metric.displayName}),$scope.timeLineHeader=$scope.timeLineMetricsDisplayNames.toString(),$scope.ivcOverTimeError=null;var timeLevel;if("Custom"!==$scope.timeFrame)timeLevel="Today"===$scope.timeFrame||"Yesterday"===$scope.timeFrame?"Hourly":"Daily";else{var gap=new Date($scope.toModel)-new Date($scope.fromModel);timeLevel=gap>0?"Daily":"Hourly"}var ivcOverTimeReport={type:"Supply",dimensions:[],metrics:$scope.timeLineMetricsFields,timeZone:$scope.timeZone,timeLevel:timeLevel,timeFrame:$scope.timeFrame,from:$scope.from,to:$scope.to,filters:$scope.filters};$scope.loadIvcOverTime=$http.post("api/reports/run",ivcOverTimeReport).then(function(response){if($scope.ivcOverTimeLabels=[0],$scope.ivcOverTimeSeries=[0],$scope.ivcOverTimeData=[0],response.data.length){var sorted=$filter("orderBy")(response.data,"date");$scope.ivcOverTimeLabels=[],$scope.ivcOverTimeSeries=$scope.timeLineMetricsDisplayNames,$scope.ivcOverTimeData=[],$scope.timeLineMetrics.forEach(function(metric){$scope.ivcOverTimeData.push([])}),sorted.forEach(function(item){$scope.ivcOverTimeLabels.push($filter("dateFormat")(item.date,timeLevel)),$scope.timeLineMetricsFields.forEach(function(fieldName,index){$scope.ivcOverTimeData[index].push(item[fieldName])})})}},function(errResponse){$scope.ivcOverTimeLabels=[0],$scope.ivcOverTimeSeries=[0],$scope.ivcOverTimeData=[0],$scope.ivcOverTimeError=errResponse.data.message})},$scope.getImpressionsForPublishersReport=function(){$scope.impressionsForPublishersError=null;var impressionsForPublishersReport={type:"Supply",dimensions:["pname"],metrics:["imp"],timeZone:$scope.timeZone,timeLevel:"Overall",timeFrame:$scope.timeFrame,from:$scope.from,to:$scope.to,filters:$scope.filters};$scope.loadImpressionsForPublishers=$http.post("api/reports/run",impressionsForPublishersReport).then(function(response){$scope.impressionsForPublishersLabels=[null],$scope.impressionsForPublishersData=[null];var total=0;if(response.data.forEach(function(item){total+=item.imp}),response.data.length){var sorted=response.data.sort(function(a,b){return b.imp-a.imp});$scope.impressionsForPublishersLabels=["Others"],$scope.impressionsForPublishersData=[0],sorted.forEach(function(item,index){index<10?($scope.impressionsForPublishersLabels.push(item.pname+" "+(item.imp/total*100).toFixed(2)+"%"),$scope.impressionsForPublishersData.push(item.imp)):$scope.impressionsForPublishersData[0]+=item.imp}),$scope.impressionsForPublishersLabels[0]+=" "+($scope.impressionsForPublishersData[0]/total*100).toFixed(2)+"%"}},function(errResponse){$scope.impressionsForPublishersLabels=[null],$scope.impressionsForPublishersData=[null],$scope.impressionsForPublishersError=errResponse.data.message})},$scope.getViewsForAdvertiserReport=function(){$scope.viewsForAdvertisersError=null;var viewsForAdvertiserReport={type:"Demand",dimensions:["advname"],metrics:["views"],timeZone:$scope.timeZone,timeLevel:"Overall",timeFrame:$scope.timeFrame,from:$scope.from,to:$scope.to,filters:$scope.filters};$scope.loadViewsForAdvertisers=$http.post("api/reports/run",viewsForAdvertiserReport).then(function(response){if($scope.viewsForAdvertisersLabels=[null],$scope.viewsForAdvertisersData=[null],response.data.length){var total=0;response.data.forEach(function(item){total+=item.views});var sorted=response.data.sort(function(a,b){return b.views-a.views});$scope.viewsForAdvertisersLabels=["Others"],$scope.viewsForAdvertisersData=[0],sorted.forEach(function(item,index){index<10?($scope.viewsForAdvertisersLabels.push(item.advname+" "+(item.views/total*100).toFixed(2)+"%"),$scope.viewsForAdvertisersData.push(item.views)):$scope.viewsForAdvertisersData[0]+=item.views}),$scope.viewsForAdvertisersLabels[0]+=" "+($scope.viewsForAdvertisersData[0]/total*100).toFixed(2)+"%"}},function(errResponse){$scope.viewsForAdvertisersLabels=[null],$scope.viewsForAdvertisersData=[null],$scope.viewsForAdvertisersError=errResponse.data.message})},$scope.loadCharts=function(){$scope.filters=[];var environments=[],types=[];$scope.environmentModel&&(Object.keys($scope.environmentModel).forEach(function(key){$scope.environmentModel[key]&&environments.push(key)}),environments.length&&$scope.filters.push({dimension:"environment",values:environments})),$scope.typeModel&&(Object.keys($scope.typeModel).forEach(function(key){$scope.typeModel[key]&&types.push(key)}),types.length&&$scope.filters.push({dimension:"type",values:types})),$scope.from=$scope.getDateString($scope.fromModel),$scope.to=$scope.getDateString($scope.toModel),$scope.getIvcOverTimeReport(),$scope.getAllMetricsReport(),$scope.isPartnerUser()||($scope.getImpressionsForPublishersReport(),$scope.getViewsForAdvertiserReport())}}]);
"use strict";angular.module("core").controller("ModalController",["$scope","$modalInstance","content",function($scope,$modalInstance,content){$scope.content=content,$scope.ok=function(){$modalInstance.close()},$scope.cancel=function(){$modalInstance.dismiss()}}]);
"use strict";angular.module("core").directive("format",["$filter",function($filter){return{require:"?ngModel",link:function(scope,elem,attrs,ctrl){ctrl&&(ctrl.$formatters.unshift(function(a){return $filter(attrs.format)(ctrl.$modelValue)}),ctrl.$parsers.unshift(function(viewValue){var plainNumber=viewValue.replace(/[^\d|\-+|\.+]/g,"");return elem.val($filter(attrs.format)(plainNumber)),plainNumber}))}}}]);
"use strict";angular.module("core").service("Menus",[function(){this.defaultRoles=["user","admin"],this.menus={};var shouldRender=function(user){if(~this.roles.indexOf("*")&&~this.seats.indexOf("*"))return!0;if(!user)return!1;for(var userRoleIndex in user.roles)for(var roleIndex in this.roles)if(this.roles[roleIndex]===user.roles[userRoleIndex]&&(this.seats.indexOf(user.seat)>=0||~this.seats.indexOf("*")))return!0;return!1};this.validateMenuExistance=function(menuId){if(menuId&&menuId.length){if(this.menus[menuId])return!0;throw new Error("Menu does not exist")}throw new Error("MenuId was not provided")},this.getMenu=function(menuId){return this.validateMenuExistance(menuId),this.menus[menuId]},this.addMenu=function(menuId,options){return options=options||{},this.menus[menuId]={roles:options.roles||this.defaultRoles,items:options.items||[],seats:options.seats,shouldRender:shouldRender},this.menus[menuId]},this.removeMenu=function(menuId){this.validateMenuExistance(menuId),delete this.menus[menuId]},this.addMenuItem=function(menuId,options){if(options=options||{},this.validateMenuExistance(menuId),this.menus[menuId].items.push({title:options.title||"",state:options.state||"",type:options.type||"item","class":options["class"],roles:null===options.roles||"undefined"==typeof options.roles?this.defaultRoles:options.roles,seats:null===options.seats||"undefined"==typeof options.seats?[]:options.seats,position:options.position||0,items:[],shouldRender:shouldRender,stateHome:options.stateHome||""}),options.items)for(var i in options.items)this.addSubMenuItem(menuId,options.state,options.items[i]);return this.menus[menuId]},this.addSubMenuItem=function(menuId,parentItemState,options){options=options||{},this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].state===parentItemState&&this.menus[menuId].items[itemIndex].items.push({title:options.title||"",state:options.state||"",roles:null===options.roles||"undefined"==typeof options.roles?this.menus[menuId].items[itemIndex].roles:options.roles,position:options.position||0,seats:null===options.seats||"undefined"==typeof options.seats?[]:options.seats,shouldRender:shouldRender});return this.menus[menuId]},this.removeMenuItem=function(menuId,menuItemState){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].state===menuItemState&&this.menus[menuId].items.splice(itemIndex,1);return this.menus[menuId]},this.removeSubMenuItem=function(menuId,submenuItemState){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)for(var subitemIndex in this.menus[menuId].items[itemIndex].items)this.menus[menuId].items[itemIndex].items[subitemIndex].state===submenuItemState&&this.menus[menuId].items[itemIndex].items.splice(subitemIndex,1);return this.menus[menuId]},this.addMenu("topbar",{roles:["*"],seats:["*"]})}]);
"use strict";angular.module("core").service("Socket",["Authentication","$state","$timeout",function(Authentication,$state,$timeout){this.connect=function(){Authentication.user&&(this.socket=io())},this.connect(),this.on=function(eventName,callback){this.socket&&this.socket.on(eventName,function(data){$timeout(function(){callback(data)})})},this.emit=function(eventName,data){this.socket&&this.socket.emit(eventName,data)},this.removeListener=function(eventName){this.socket&&this.socket.removeListener(eventName)}}]);
"use strict";angular.module("users.admin").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Admin",state:"admin",stateHome:"admin.users",position:7,roles:["admin"],seats:["*"]})}]);
"use strict";angular.module("users.admin.routes").config(["$stateProvider",function($stateProvider){$stateProvider.state("admin",{"abstract":!0,url:"/admin",template:"<ui-view/>",data:{roles:["admin"]}}).state("admin.users",{url:"/users",templateUrl:"modules/users/client/views/admin/user-list.client.view.html",data:{roles:["admin"]}}).state("admin.user-invite",{url:"/users/invite",templateUrl:"modules/users/client/views/admin/user-invite.client.view.html",data:{roles:["admin"]}}).state("admin.user",{url:"/users/:userId",templateUrl:"modules/users/client/views/admin/user.client.view.html",data:{roles:["admin"]}}).state("admin.user-edit",{url:"/users/:userId/edit",templateUrl:"modules/users/client/views/admin/user-edit.client.view.html",data:{roles:["admin"]}})}]);
"use strict";angular.module("users").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$q","$location","Authentication",function($q,$location,Authentication){return{responseError:function(rejection){switch(rejection.status){case 401:Authentication.user=null,$location.path("signin");break;case 403:}return $q.reject(rejection)}}}])}]);
"use strict";angular.module("users").config(["$stateProvider",function($stateProvider){$stateProvider.state("settings",{"abstract":!0,url:"/settings",templateUrl:"modules/users/client/views/settings/settings.client.view.html",data:{roles:["user","admin","publisher","advertiser","publisher_CPM","publisher_CPV"]}}).state("settings.profile",{url:"/profile",templateUrl:"modules/users/client/views/settings/edit-profile.client.view.html"}).state("settings.password",{url:"/password",templateUrl:"modules/users/client/views/settings/change-password.client.view.html"}).state("settings.picture",{url:"/picture",templateUrl:"modules/users/client/views/settings/change-profile-picture.client.view.html"}).state("authentication",{"abstract":!0,url:"/authentication",templateUrl:"modules/users/client/views/authentication/authentication.client.view.html"}).state("authentication.signup",{url:"/signup/:token",templateUrl:"modules/users/client/views/authentication/signup.client.view.html"}).state("authentication.signin",{url:"/",templateUrl:"modules/core/client/views/home.client.view.html"}).state("password",{"abstract":!0,url:"/password",template:"<ui-view/>"}).state("password.forgot",{url:"/forgot",templateUrl:"modules/users/client/views/password/forgot-password.client.view.html"}).state("password.reset",{"abstract":!0,url:"/reset",template:"<ui-view/>"}).state("password.reset.invalid",{url:"/invalid",templateUrl:"modules/users/client/views/password/reset-password-invalid.client.view.html"}).state("password.reset.success",{url:"/success",templateUrl:"modules/users/client/views/password/reset-password-success.client.view.html"}).state("password.reset.form",{url:"/:token",templateUrl:"modules/users/client/views/password/reset-password.client.view.html"})}]);
"use strict";angular.module("users").controller("AuthenticationController",["$scope","$state","$stateParams","$http","$location","$window","Authentication",function($scope,$state,$stateParams,$http,$location,$window,Authentication){$scope.authentication=Authentication,$scope.error=$location.search().err,$scope.authentication.user&&$location.path("/"),$scope.signup=function(){$scope.credentials.token=$stateParams.token,$http.post("/api/auth/signup",$scope.credentials).success(function(response){$scope.authentication.user=response,$state.go($state.previous.state.name||"home",$state.previous.params)}).error(function(response){$scope.error=response.message})},$scope.signin=function(){$http.post("/api/auth/signin",$scope.credentials).success(function(response){$scope.authentication.user=response,console.log("klsdfhkljfhasd"),$state.go($state.previous.state.name||"home",$state.previous.params)}).error(function(response){console.log("xxxxxxxxxxxxxxxxx",$scope.credentials),$scope.error=response.message})}}]);
"use strict";angular.module("users").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication",function($scope,$stateParams,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.askForPasswordReset=function(){$scope.success=$scope.error=null,$http.post("/api/auth/forgot",$scope.credentials).success(function(response){$scope.credentials=null,$scope.success=response.message}).error(function(response){$scope.credentials=null,$scope.error=response.message})},$scope.resetUserPassword=function(){$scope.success=$scope.error=null,$http.post("/api/auth/reset/"+$stateParams.token,$scope.passwordDetails).success(function(response){$scope.passwordDetails=null,Authentication.user=response,$location.path("/password/reset/success")}).error(function(response){$scope.error=response.message})}}]);
"use strict";angular.module("users").factory("Authentication",["$window",function($window){var auth={user:$window.user};return auth}]);
"use strict";angular.module("users.admin").factory("Partners",["$resource",function($resource){return $resource("api/partners/:partnerId",{partnerId:"@_id"},{update:{method:"PUT"}})}]);
"use strict";angular.module("users").factory("Users",["$resource",function($resource){return $resource("api/users",{},{update:{method:"PUT"}})}]),angular.module("users.admin").factory("Admin",["$resource",function($resource){return $resource("api/users/:userId",{userId:"@_id"},{update:{method:"PUT"}})}]);
"use strict";angular.module("users.admin").controller("UserController",["$scope","$state","$stateParams","$location","$filter","Authentication","Admin","toastr",function($scope,$state,$stateParams,$location,$filter,Authentication,Admin,toastr){$scope.authentication=Authentication,$scope.availableSeats=["Positive Mobile","Ybrant Digital","Positive Mobile LATAM","Positive Mobile Israel","Web3","Tabascom","Literally","Matomy"],$scope.seat={},$scope.buildPager=function(){$scope.pagedItems=[],$scope.itemsPerPage=15,$scope.currentPage=1,$scope.figureOutItemsToDisplay()},$scope.figureOutItemsToDisplay=function(){$scope.filteredItems=$filter("filter")($scope.users,{$:$scope.search}),$scope.filterLength=$scope.filteredItems.length;var begin=($scope.currentPage-1)*$scope.itemsPerPage,end=begin+$scope.itemsPerPage;$scope.pagedItems=$scope.filteredItems.slice(begin,end)},$scope.pageChanged=function(){$scope.figureOutItemsToDisplay()},$scope.remove=function(user){confirm("Are you sure you want to delete this user?")&&(user?(user.$remove(),$scope.users.splice($scope.users.indexOf(user),1)):$scope.user.$remove(function(){$state.go("admin.users")}))},$scope.update=function(){var user=$scope.user;$scope.updateUser=user.$update(function(){$state.go("admin.user",{userId:user._id})},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.invite=function(){var invitation=new Admin({to:this.to,email:this.email,seat:this.seat.selected}),recipient=this.to;$scope.inviteUser=invitation.$save(function(response){$location.path("/admin/users"),toastr.success("Invitation email to "+recipient,"Has been sent successfully"),$scope.to="",$scope.email="",$scope.seat=""},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.loadUsers=Admin.query(function(data){$scope.users=data,$scope.buildPager()})},$scope.findOne=function(){$scope.user=Admin.get({userId:$stateParams.userId})}}]);
"use strict";angular.module("users").controller("PartnerEditController",["$scope","$modalInstance","availableItems","modelName","number","items",function($scope,$modalInstance,availableItems,modelName,number,items){$scope.modelName=modelName,$scope.number=number,$scope.availableItems=availableItems,$scope.selections={},$scope.selections.items=items,$scope.save=function(){var uniqueItems=[],newItems=$scope.selections.items.filter(function(item){return!(uniqueItems.indexOf(item._id)>=0)&&(uniqueItems.push(item._id),!0)});console.log(newItems),$modalInstance.close(newItems)},$scope.cancel=function(){$modalInstance.dismiss()}}]);
"use strict";angular.module("users").controller("PartnerInviteController",["$scope","$modalInstance","title","to","availableItems","modelName","number",function($scope,$modalInstance,title,to,availableItems,modelName,number){$scope.role="publisher_CPM",$scope.to=to,$scope.title=title,$scope.modelName=modelName,$scope.number=number,$scope.availableItems=availableItems,$scope.selections={},$scope.selections.items=availableItems.map(function(availableItem){return availableItem._id}),$scope.save=function(){var invitation={};invitation.to=$scope.to,invitation.items=$scope.selections.items,invitation.email=$scope.email,invitation.role=$scope.role,$modalInstance.close(invitation)},$scope.cancel=function(){$modalInstance.dismiss()}}]);
"use strict";angular.module("users").controller("ChangePasswordController",["$scope","$http","Authentication",function($scope,$http,Authentication){$scope.user=Authentication.user,$scope.changeUserPassword=function(){$scope.success=$scope.error=null,$http.post("/api/users/password",$scope.passwordDetails).success(function(response){$scope.success=!0,$scope.passwordDetails=null}).error(function(response){$scope.error=response.message})}}]);
"use strict";angular.module("users").controller("ChangeProfilePictureController",["$scope","$timeout","$window","Authentication","FileUploader",function($scope,$timeout,$window,Authentication,FileUploader){$scope.user=Authentication.user,$scope.imageURL=$scope.user.profileImageURL,$scope.uploader=new FileUploader({url:"api/users/picture"}),$scope.uploader.filters.push({name:"imageFilter",fn:function(item,options){var type="|"+item.type.slice(item.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(type)!==-1}}),$scope.uploader.onAfterAddingFile=function(fileItem){if($window.FileReader){var fileReader=new FileReader;fileReader.readAsDataURL(fileItem._file),fileReader.onload=function(fileReaderEvent){$timeout(function(){$scope.imageURL=fileReaderEvent.target.result},0)}}},$scope.uploader.onSuccessItem=function(fileItem,response,status,headers){$scope.success=!0,$scope.user=Authentication.user=response,$scope.cancelUpload()},$scope.uploader.onErrorItem=function(fileItem,response,status,headers){$scope.cancelUpload(),$scope.error=response.message},$scope.uploadProfilePicture=function(){$scope.success=$scope.error=null,$scope.uploader.uploadAll()},$scope.cancelUpload=function(){$scope.uploader.clearQueue(),$scope.imageURL=$scope.user.profileImageURL}}]);
"use strict";angular.module("users").controller("EditProfileController",["$scope","$http","$location","Users","Authentication",function($scope,$http,$location,Users,Authentication){$scope.user=Authentication.user,$scope.updateUserProfile=function(isValid){if(isValid){$scope.success=$scope.error=null;var user=new Users($scope.user);user.$update(function(response){$scope.success=!0,Authentication.user=response},function(response){$scope.error=response.data.message})}else $scope.submitted=!0}}]);
"use strict";angular.module("users").controller("SocialAccountsController",["$scope","$http","Authentication",function($scope,$http,Authentication){$scope.user=Authentication.user,$scope.hasConnectedAdditionalSocialAccounts=function(provider){for(var i in $scope.user.additionalProvidersData)return!0;return!1},$scope.isConnectedSocialAccount=function(provider){return $scope.user.provider===provider||$scope.user.additionalProvidersData&&$scope.user.additionalProvidersData[provider]},$scope.removeUserSocialAccount=function(provider){$scope.success=$scope.error=null,$http["delete"]("/api/users/accounts",{params:{provider:provider}}).success(function(response){$scope.success=!0,$scope.user=Authentication.user=response}).error(function(response){$scope.error=response.message})}}]);
"use strict";angular.module("users").controller("SettingsController",["$scope","Authentication",function($scope,Authentication){$scope.user=Authentication.user}]);